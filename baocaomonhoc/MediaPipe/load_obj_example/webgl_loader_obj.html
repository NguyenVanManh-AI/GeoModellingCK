<!DOCTYPE html>
<html lang="en">

<head>
	<title>three.js webgl - loaders - OBJ loader</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
	<style>
		body {
			font-family: Monospace;
			color: #fff;
			margin: 0px;
		}

		#cube {
			max-width: 100%;
			width: 100%;
			height: 100%;
		}
	</style>
</head>

<body>
	<div id="cube"></div>
	<script src="three.min.js"></script>
	<script src="OBJLoader.js"></script>
	<script src="Detector.js"></script>
	<script src="stats.min.js"></script>
	<script type="module">
var container;
var camera, scene, renderer;
var rotating = false;
var actionRotate = 'XN';
var targetRotation = 0;
var ySpeed = 0;

var loadedObject; 
		init();
		animate();
		function init() {
			camera = new THREE.PerspectiveCamera(100, window.innerWidth / window.innerHeight, 1, 10000);
			camera.position.z = 200;
			// scene
			scene = new THREE.Scene();
			var directionalLight = new THREE.DirectionalLight(0xffeedd);
			directionalLight.position.set(0, 0, 1).normalize();
			scene.add(directionalLight);
			// texture
			var texture = new THREE.Texture();
			var loader = new THREE.ImageLoader();
			loader.addEventListener('load', function (event) {
				texture.image = event.content;
				texture.needsUpdate = true;
			});
			loader.load('ash_uvgrid01.jpg');
			// model
			var loader = new THREE.OBJLoader();
			loader.addEventListener('load', function (event) {
				var object = event.content;
				loadedObject = object; // Lưu đối tượng đã load vào biến global
				for (var i = 0, l = object.children.length; i < l; i++) {
					object.children[i].material.map = texture;
				}
				scene.add(object);
			});
			loader.load('../obj/cone.obj');
			//
			renderer = new THREE.WebGLRenderer();
			renderer.setSize(window.innerWidth, window.innerHeight);
			document.getElementById("cube").appendChild(renderer.domElement);
		}
		function animate() {
			requestAnimationFrame(animate);
			if (rotating) {
        if (actionRotate == 'XC') {
          loadedObject.rotation.x += ySpeed;
          if (loadedObject.rotation.x >= targetRotation) {
            rotating = false;
            ySpeed = 0;
          }
        }
        if (actionRotate == 'XN') {
          loadedObject.rotation.x -= ySpeed;
          if (loadedObject.rotation.x <= targetRotation) {
            rotating = false;
            ySpeed = 0;
          }
        }
        if (actionRotate == 'YC') {
          loadedObject.rotation.y += ySpeed;
          if (loadedObject.rotation.y >= targetRotation) {
            rotating = false;
            ySpeed = 0;
          }
        }
        if (actionRotate == 'YN') {
          loadedObject.rotation.y -= ySpeed;
          if (loadedObject.rotation.y <= targetRotation) {
            rotating = false;
            ySpeed = 0;
          }
        }
        if (actionRotate == 'ZC') {
          loadedObject.rotation.z += ySpeed;
          if (loadedObject.rotation.z >= targetRotation) {
            rotating = false;
            ySpeed = 0;
          }
        }
        if (actionRotate == 'ZN') {
          loadedObject.rotation.z -= ySpeed;
          if (loadedObject.rotation.z <= targetRotation) {
            rotating = false;
            ySpeed = 0;
          }
        }
      }
    
			renderer.render(scene, camera);

		}

		function rotateXC() {
      actionRotate = 'XC';
      rotating = true;
      targetRotation += Math.PI / 6;
      ySpeed = Math.PI / 180;
    }

    function rotateXN() {
      actionRotate = 'XN';
      rotating = true;
      targetRotation -= Math.PI / 6;
      ySpeed = Math.PI / 180;
    }

    function rotateYC() {
      actionRotate = 'YC';
      rotating = true;
      targetRotation += Math.PI / 6;
      ySpeed = Math.PI / 180;
    }


    function rotateYN() {
      actionRotate = 'YN';
      rotating = true;
      targetRotation -= Math.PI / 6;
      ySpeed = Math.PI / 180;
    }



    function rotateZC() {
      actionRotate = 'ZC';
      rotating = true;
      targetRotation += Math.PI / 6;
      ySpeed = Math.PI / 180;
    }



    function rotateZN() {
      actionRotate = 'ZN';
      rotating = true;
      targetRotation -= Math.PI / 6;
      ySpeed = Math.PI / 180;
    }


    document.getElementById("rotateXCButton").addEventListener("click", rotateXC);

    document.getElementById("rotateXNButton").addEventListener("click", rotateXN);

    document.getElementById("rotateYCButton").addEventListener("click", rotateYC);

    document.getElementById("rotateYNButton").addEventListener("click", rotateYN);

    document.getElementById("rotateZCButton").addEventListener("click", rotateZC);

    document.getElementById("rotateZNButton").addEventListener("click", rotateZN);


		// zoomIn and zoomOut
		var zoomAmount = 0.6; // Lượng zoom mỗi lần click

		function zoomIn() {
    if (!loadedObject) return; // Kiểm tra xem có đối tượng đã load hay không
    var currentScale = loadedObject.scale.x;
    var targetScale = currentScale - zoomAmount;
    animateScale(loadedObject, currentScale, targetScale);
}

function zoomOut() {
    if (!loadedObject) return; // Kiểm tra xem có đối tượng đã load hay không
    var currentScale = loadedObject.scale.x;
    var targetScale = currentScale + zoomAmount;
    animateScale(loadedObject, currentScale, targetScale);
}
		document.getElementById("zoomInButton").addEventListener("click", zoomIn);
		document.getElementById("zoomOutButton").addEventListener("click", zoomOut);

		function animateScale(object, currentScale, targetScale) {
			var scaleSpeed = 0.03; // Tốc độ thay đổi scale
			var animateScaleInternal = function () {
				if ((currentScale < targetScale && object.scale.x < targetScale) ||
					(currentScale > targetScale && object.scale.x > targetScale)) {
					object.scale.x += (targetScale - currentScale) * scaleSpeed;
					object.scale.y += (targetScale - currentScale) * scaleSpeed;
					object.scale.z += (targetScale - currentScale) * scaleSpeed;
					requestAnimationFrame(animateScaleInternal);
				}
			};

			animateScaleInternal();
		}
		// zoomIn and zoomOut
	</script>
	        <button type="button" class="m-1 btn btn-outline-success" id="rotateXCButton">rotate XC</button>
			<button type="button" class="m-1 btn btn-outline-success" id="rotateXNButton">rotate XN</button>
			<button type="button" class="m-1 btn btn-outline-success" id="rotateYCButton">rotate YC</button>
			<button type="button" class="m-1 btn btn-outline-success" id="rotateYNButton">rotate YN</button>
			<button type="button" class="m-1 btn btn-outline-success" id="rotateZCButton">rotate ZC</button>
			<button type="button" class="m-1 btn btn-outline-success" id="rotateZNButton">rotate ZN</button>
	<button type="button" class="m-1 btn btn-outline-primary" id="zoomInButton">zoomIn</button>
	<button type="button" class="m-1 btn btn-outline-primary" id="zoomOutButton">zoomOut</button>
</body>

</html>